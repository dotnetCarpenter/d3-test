<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>d3 test</title>
  <style>
    /* center */
    body {
      margin: 0 auto;
      width:400px;
    }
    /* */
/*    fieldset, svg {
      display: inline-block;
      width: 400px;
    }*/
  </style>
  
</head>
<body>
  <script src="lib/d3.js?3.3.0"></script>
  <script src="dataset.js"></script>
  <script>
    (function(d3, doc, win, dataset) {
      "use strict";

      var size        = win.innerHeight, //height/width
        radius        = size/2,
        color         = d3.scale.category20b(), //builtin range of colors
        nextIndex     = function(value) { // calculate the next dataset index
                          value = value || 0;
                          return function () {
                            return (value++ % dataset.length);
                          }
                        }(),
      //  datasetIndex  = 0,
        pie           = d3.layout.pie()
                        .value(function(d) { return d.value; }),
        arc           = d3.svg.arc()
                          .outerRadius(radius),
        svg           = d3.select("body")
                          .append("svg")
                          .attr("width", size)
                          .attr("height", size)
                          .append("g")
                          .attr("transform", "translate(" + radius + "," + radius + ")"),
        path          = svg.datum(dataset[nextIndex()])
                          .selectAll("path")
                          .data(pie)
                          .enter()                          
                          .append("g")
                          .attr("class", "slice")
                          .append("path")
                          .attr("fill", function(d, i) { return color(i); })
                          .attr("d", arc)
                          .each(function(d) { // store the initial angles
                            this._current = d;
                          })

      // set text
      // svg
      //   .selectAll("g.slice")
      //   .insert("text") //add a label to each slice
      //   .attr("transform", function (d) { //set the label's origin to the center of the arc
      //     //we have to make sure to set these before calling arc.centroid
      //     d.innerRadius = 0;
      //     d.outerRadius = radius;
      //     return "translate(" + arc.centroid(d) + ")"; //this gives us a pair of coordinates like [50, 50]
      //   })
      //   .attr("text-anchor", "middle") //center the text on it's origin
      //   .text(function (d) {
      //     var value = d.data.value;
      //     return value < 100 && value > 0 ? d.data.label : "";
      //   });

      // start animation
      win.repeater = win.setInterval(change, 1250);

      function change() {
        svg.datum(dataset[nextIndex()]);
        path.data(pie);
        path.transition().duration(750).attrTween("d", arcTween); // redraw the arcs
      }

      // Store the displayed angles in _current.
      // Then, interpolate from _current to the new angles.
      // During the transition, _current is updated in-place by d3.interpolate.
      function arcTween(a) {
        var i = d3.interpolate(this._current, a);
        this._current = i(0);
        // d3
        //   .select(this.nextSibling)
        //   .attr("transform", function (d) { //set the label's origin to the center of the arc
        //     return "translate(" + arc.centroid(d) + ")"; //this gives us a pair of coordinates like [50, 50]
        //   })
        //   .attr("text-anchor", "middle") //center the text on it's origin
        //   .text(function (d) {
        //       return d.data.label;
        //   });
        return function(t) {
          return arc(i(t));
        };
      }
      
    }(d3, document, window, dataset));
    </script>
  </body>
</html>